var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,n=(e,s)=>{for(var t in s||(s={}))l.call(s,t)&&i(e,t,s[t]);if(a)for(var t of a(s))r.call(s,t)&&i(e,t,s[t]);return e};import{j as c,a as d,A as o,m as x,X as h,$ as m,a0 as p,b as u,a1 as b,D as g,a2 as j,a3 as w,a4 as v,B as N,a5 as f,S as y,M as S}from"./ui-vendor-D0r6Jywv.js";import{u as k,r as C}from"./react-vendor-1Jw84dll.js";import{u as P,g as O,z as E}from"./index-CzaAzuHO.js";import{m as I}from"./gemini-Bdp0gSYa.js";import"./state-Cv3e63x1.js";const A=()=>{var e,a;const l=k(),{currentBook:r,currentPage:i,setCurrentPage:A,addNote:M,user:B}=P(),[D,T]=C.useState(!1),[$,z]=C.useState(!1),[L,R]=C.useState(!1),[F,G]=C.useState(""),[H,K]=C.useState(""),[U,q]=C.useState(""),[J,Q]=C.useState(100),[V,W]=C.useState("");if(C.useEffect(()=>{r&&(T(!0),setTimeout(()=>{W(O(r.id,i)),T(!1)},500),P.getState().startStudySession(r.id))},[r,i]),!r)return c.jsx("div",{className:"flex items-center justify-center h-full",children:c.jsxs("div",{className:"text-center",children:[c.jsx(d,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),c.jsx("p",{className:"text-gray-400 mb-4",children:"No book selected"}),c.jsx("button",{onClick:()=>l("/library"),className:"text-medical-blue hover:text-medical-cyan transition-colors",children:"Go to Library"})]})});const X=r.chapters?Math.max(...r.chapters.map(e=>e.pageEnd)):100,Y=e=>{if(e>=1&&e<=X){A(e);const s=Math.round(e/X*100);P.getState().updateBookProgress(r.id,s)}},Z=()=>{return e=void 0,a=null,l=function*(){var e,a;if(H.trim()){T(!0);try{const d=yield I.generateResponse(H,{bookId:r.id,currentPage:i,currentChapter:null==(a=null==(e=r.chapters)?void 0:e.find(e=>i>=e.pageStart&&i<=e.pageEnd))?void 0:a.title,recentTopics:[r.category],userLevel:(null==B?void 0:B.level)||"student"},V);q(d.response),P.getState().addAIResponse(d);const o=P.getState().currentSession;o&&P.setState({currentSession:(l=n({},o),c={aiInteractions:o.aiInteractions+1},s(l,t(c)))})}catch(d){E.error("Failed to get AI response")}finally{T(!1)}var l,c}},new Promise((s,t)=>{var r=e=>{try{n(l.next(e))}catch(s){t(s)}},i=e=>{try{n(l.throw(e))}catch(s){t(s)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,i);n((l=l.apply(e,a)).next())});var e,a,l},_=null==(e=r.chapters)?void 0:e.find(e=>i>=e.pageStart&&i<=e.pageEnd);return c.jsxs("div",{className:"h-full flex",children:[c.jsx(o,{children:L&&c.jsxs(x.div,{initial:{x:-300},animate:{x:0},exit:{x:-300},className:"w-80 glass border-r border-white/10 p-4 overflow-y-auto",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-white",children:"Chapters"}),c.jsx("button",{onClick:()=>R(!1),className:"p-1 rounded hover:bg-white/10 transition-colors",children:c.jsx(h,{className:"w-5 h-5 text-gray-400"})})]}),c.jsx("div",{className:"space-y-2",children:null==(a=r.chapters)?void 0:a.map(e=>c.jsx("button",{onClick:()=>Y(e.pageStart),className:"w-full text-left p-3 rounded-lg transition-all "+((null==_?void 0:_.id)===e.id?"bg-medical-blue/20 border border-medical-blue/50":"hover:bg-white/5"),children:c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(m,{className:"w-4 h-4 mt-0.5 "+((null==_?void 0:_.id)===e.id?"text-medical-blue":"text-gray-400")}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm font-medium "+((null==_?void 0:_.id)===e.id?"text-white":"text-gray-300"),children:e.title}),c.jsxs("p",{className:"text-xs text-gray-500",children:["Pages ",e.pageStart,"-",e.pageEnd]})]}),e.completed&&c.jsx("div",{className:"w-5 h-5 rounded-full bg-medical-green/20 flex items-center justify-center",children:c.jsx("div",{className:"w-2 h-2 rounded-full bg-medical-green"})})]})},e.id))})]})}),c.jsxs("div",{className:"flex-1 flex flex-col",children:[c.jsxs("div",{className:"glass border-b border-white/10 px-4 py-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("button",{onClick:()=>l("/library"),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:c.jsx(p,{className:"w-5 h-5 text-white"})}),c.jsx("button",{onClick:()=>R(!L),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:c.jsx(u,{className:"w-5 h-5 text-white"})}),c.jsx("div",{className:"h-8 w-px bg-white/10"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:()=>Y(i-1),disabled:1===i,className:"p-2 rounded-lg hover:bg-white/10 transition-colors disabled:opacity-50",children:c.jsx(b,{className:"w-5 h-5 text-white"})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"number",value:i,onChange:e=>Y(parseInt(e.target.value)||1),className:"w-16 px-2 py-1 rounded bg-white/5 border border-white/10 text-white text-center",min:1,max:X}),c.jsxs("span",{className:"text-gray-400",children:["/ ",X]})]}),c.jsx("button",{onClick:()=>Y(i+1),disabled:i===X,className:"p-2 rounded-lg hover:bg-white/10 transition-colors disabled:opacity-50",children:c.jsx(g,{className:"w-5 h-5 text-white"})})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:()=>Q(Math.max(50,J-10)),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:c.jsx(j,{className:"w-5 h-5 text-white"})}),c.jsxs("span",{className:"text-sm text-gray-400 w-12 text-center",children:[J,"%"]}),c.jsx("button",{onClick:()=>Q(Math.min(200,J+10)),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:c.jsx(w,{className:"w-5 h-5 text-white"})}),c.jsx("div",{className:"h-8 w-px bg-white/10 mx-2"}),c.jsx("button",{onClick:()=>E.success("Bookmark added"),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:c.jsx(v,{className:"w-5 h-5 text-white"})}),c.jsx("button",{onClick:()=>z(!$),className:"p-2 rounded-lg transition-colors "+($?"bg-medical-purple/20 text-medical-purple":"hover:bg-white/10 text-white"),children:c.jsx(N,{className:"w-5 h-5"})}),c.jsx("button",{onClick:()=>{if(F){const e={id:`note-${Date.now()}`,page:i,content:F,timestamp:new Date,highlight:{text:F,position:{x:0,y:0}}};M(e),E.success("Note added"),G("")}},disabled:!F,className:"p-2 rounded-lg hover:bg-white/10 transition-colors disabled:opacity-50",children:c.jsx(f,{className:"w-5 h-5 text-white"})})]})]}),_&&c.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[c.jsx(d,{className:"w-4 h-4 text-medical-blue"}),c.jsx("span",{className:"text-sm text-gray-300",children:_.title})]})]}),c.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[c.jsx("div",{className:"flex-1 overflow-y-auto p-8",onMouseUp:()=>{const e=window.getSelection(),s=null==e?void 0:e.toString().trim();s&&(G(s),z(!0),K(`Explain: "${s}"`))},style:{fontSize:`${J}%`},children:D?c.jsx("div",{className:"flex items-center justify-center h-full",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-medical-blue"})}):c.jsx("div",{className:"max-w-4xl mx-auto",children:c.jsxs("div",{className:"glass rounded-xl p-12 leading-relaxed",children:[c.jsx("h2",{className:"text-3xl font-bold text-white mb-6",children:r.title}),c.jsx("div",{className:"prose prose-lg prose-invert",children:c.jsx("pre",{className:"whitespace-pre-wrap font-sans text-gray-200",children:V})})]})})}),c.jsx(o,{children:$&&c.jsxs(x.div,{initial:{width:0,opacity:0},animate:{width:400,opacity:1},exit:{width:0,opacity:0},className:"glass border-l border-white/10 flex flex-col",children:[c.jsx("div",{className:"p-4 border-b border-white/10",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(N,{className:"w-5 h-5 text-medical-purple"}),c.jsx("h3",{className:"text-lg font-semibold text-white",children:"AI Assistant"})]}),c.jsx("button",{onClick:()=>z(!1),className:"p-1 rounded hover:bg-white/10 transition-colors",children:c.jsx(h,{className:"w-5 h-5 text-gray-400"})})]})}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[F&&c.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-medical-blue/10 border border-medical-blue/20",children:[c.jsx("p",{className:"text-xs text-medical-blue mb-1",children:"Selected Text:"}),c.jsx("p",{className:"text-sm text-gray-300",children:F})]}),U&&c.jsx("div",{className:"mb-4 p-4 rounded-lg bg-white/5 border border-white/10",children:c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(y,{className:"w-4 h-4 text-medical-purple mt-1"}),c.jsx("div",{className:"flex-1",children:c.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:U})})]})})]}),c.jsx("div",{className:"p-4 border-t border-white/10",children:c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"text",value:H,onChange:e=>K(e.target.value),onKeyPress:e=>"Enter"===e.key&&Z(),placeholder:"Ask about this content...",className:"flex-1 px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-medical-purple"}),c.jsx(x.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:Z,disabled:D||!H.trim(),className:"p-2 rounded-lg bg-medical-purple hover:bg-medical-purple/80 disabled:opacity-50",children:D?c.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}):c.jsx(S,{className:"w-5 h-5 text-white"})})]})})]})})]})]})]})};export{A as default};
