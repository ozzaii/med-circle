var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,n=(e,s)=>{for(var t in s||(s={}))l.call(s,t)&&i(e,t,s[t]);if(a)for(var t of a(s))r.call(s,t)&&i(e,t,s[t]);return e};import{j as c,a as d,A as o,m as x,X as h,K as m,O as p,c as u,P as b,n as g,Q as j,W as w,Y as v,B as N,_ as f,b as y,M as S}from"./ui-vendor-C9uOnbQd.js";import{u as k,r as C}from"./react-vendor-1Jw84dll.js";import{u as P,g as O,z as E}from"./index-Cxi6hhvr.js";import{m as I}from"./gemini-Blo2tQKi.js";import"./state-Cv3e63x1.js";const A=()=>{var e,a;const l=k(),{currentBook:r,currentPage:i,setCurrentPage:A,addNote:M,user:B}=P(),[T,D]=C.useState(!1),[$,z]=C.useState(!1),[K,L]=C.useState(!1),[R,F]=C.useState(""),[G,H]=C.useState(""),[Q,U]=C.useState(""),[W,Y]=C.useState(100),[_,q]=C.useState("");if(C.useEffect(()=>{r&&(D(!0),setTimeout(()=>{q(O(r.id,i)),D(!1)},500),P.getState().startStudySession(r.id))},[r,i]),!r)return c.jsx("div",{className:"flex items-center justify-center h-full",children:c.jsxs("div",{className:"text-center",children:[c.jsx(d,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),c.jsx("p",{className:"text-gray-400 mb-4",children:"No book selected"}),c.jsx("button",{onClick:()=>l("/library"),className:"text-medical-blue hover:text-medical-cyan transition-colors",children:"Go to Library"})]})});const J=r.chapters?Math.max(...r.chapters.map(e=>e.pageEnd)):100,V=e=>{if(e>=1&&e<=J){A(e);const s=Math.round(e/J*100);P.getState().updateBookProgress(r.id,s)}},X=()=>{return e=void 0,a=null,l=function*(){var e,a;if(G.trim()){D(!0);try{const d=yield I.generateResponse(G,{bookId:r.id,currentPage:i,currentChapter:null==(a=null==(e=r.chapters)?void 0:e.find(e=>i>=e.pageStart&&i<=e.pageEnd))?void 0:a.title,recentTopics:[r.category],userLevel:(null==B?void 0:B.level)||"student"},_);U(d.response),P.getState().addAIResponse(d);const o=P.getState().currentSession;o&&P.setState({currentSession:(l=n({},o),c={aiInteractions:o.aiInteractions+1},s(l,t(c)))})}catch(d){E.error("Failed to get AI response")}finally{D(!1)}var l,c}},new Promise((s,t)=>{var r=e=>{try{n(l.next(e))}catch(s){t(s)}},i=e=>{try{n(l.throw(e))}catch(s){t(s)}},n=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,i);n((l=l.apply(e,a)).next())});var e,a,l},Z=null==(e=r.chapters)?void 0:e.find(e=>i>=e.pageStart&&i<=e.pageEnd);return c.jsxs("div",{className:"h-full flex",children:[c.jsx(o,{children:K&&c.jsxs(x.div,{initial:{x:-300},animate:{x:0},exit:{x:-300},className:"w-80 glass border-r border-white/10 p-4 overflow-y-auto",children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-white",children:"Chapters"}),c.jsx("button",{onClick:()=>L(!1),className:"p-1 rounded hover:bg-white/10 transition-colors",children:c.jsx(h,{className:"w-5 h-5 text-gray-400"})})]}),c.jsx("div",{className:"space-y-2",children:null==(a=r.chapters)?void 0:a.map(e=>c.jsx("button",{onClick:()=>V(e.pageStart),className:"w-full text-left p-3 rounded-lg transition-all "+((null==Z?void 0:Z.id)===e.id?"bg-medical-blue/20 border border-medical-blue/50":"hover:bg-white/5"),children:c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(m,{className:"w-4 h-4 mt-0.5 "+((null==Z?void 0:Z.id)===e.id?"text-medical-blue":"text-gray-400")}),c.jsxs("div",{className:"flex-1",children:[c.jsx("p",{className:"text-sm font-medium "+((null==Z?void 0:Z.id)===e.id?"text-white":"text-gray-300"),children:e.title}),c.jsxs("p",{className:"text-xs text-gray-500",children:["Pages ",e.pageStart,"-",e.pageEnd]})]}),e.completed&&c.jsx("div",{className:"w-5 h-5 rounded-full bg-medical-green/20 flex items-center justify-center",children:c.jsx("div",{className:"w-2 h-2 rounded-full bg-medical-green"})})]})},e.id))})]})}),c.jsxs("div",{className:"flex-1 flex flex-col",children:[c.jsxs("div",{className:"glass border-b border-white/10 px-4 py-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("button",{onClick:()=>l("/library"),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:c.jsx(p,{className:"w-5 h-5 text-white"})}),c.jsx("button",{onClick:()=>L(!K),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:c.jsx(u,{className:"w-5 h-5 text-white"})}),c.jsx("div",{className:"h-8 w-px bg-white/10"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:()=>V(i-1),disabled:1===i,className:"p-2 rounded-lg hover:bg-white/10 transition-colors disabled:opacity-50",children:c.jsx(b,{className:"w-5 h-5 text-white"})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"number",value:i,onChange:e=>V(parseInt(e.target.value)||1),className:"w-16 px-2 py-1 rounded bg-white/5 border border-white/10 text-white text-center",min:1,max:J}),c.jsxs("span",{className:"text-gray-400",children:["/ ",J]})]}),c.jsx("button",{onClick:()=>V(i+1),disabled:i===J,className:"p-2 rounded-lg hover:bg-white/10 transition-colors disabled:opacity-50",children:c.jsx(g,{className:"w-5 h-5 text-white"})})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:()=>Y(Math.max(50,W-10)),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:c.jsx(j,{className:"w-5 h-5 text-white"})}),c.jsxs("span",{className:"text-sm text-gray-400 w-12 text-center",children:[W,"%"]}),c.jsx("button",{onClick:()=>Y(Math.min(200,W+10)),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:c.jsx(w,{className:"w-5 h-5 text-white"})}),c.jsx("div",{className:"h-8 w-px bg-white/10 mx-2"}),c.jsx("button",{onClick:()=>E.success("Bookmark added"),className:"p-2 rounded-lg hover:bg-white/10 transition-colors",children:c.jsx(v,{className:"w-5 h-5 text-white"})}),c.jsx("button",{onClick:()=>z(!$),className:"p-2 rounded-lg transition-colors "+($?"bg-medical-purple/20 text-medical-purple":"hover:bg-white/10 text-white"),children:c.jsx(N,{className:"w-5 h-5"})}),c.jsx("button",{onClick:()=>{if(R){const e={id:`note-${Date.now()}`,page:i,content:R,timestamp:new Date,highlight:{text:R,position:{x:0,y:0}}};M(e),E.success("Note added"),F("")}},disabled:!R,className:"p-2 rounded-lg hover:bg-white/10 transition-colors disabled:opacity-50",children:c.jsx(f,{className:"w-5 h-5 text-white"})})]})]}),Z&&c.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[c.jsx(d,{className:"w-4 h-4 text-medical-blue"}),c.jsx("span",{className:"text-sm text-gray-300",children:Z.title})]})]}),c.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[c.jsx("div",{className:"flex-1 overflow-y-auto p-8",onMouseUp:()=>{const e=window.getSelection(),s=null==e?void 0:e.toString().trim();s&&(F(s),z(!0),H(`Explain: "${s}"`))},style:{fontSize:`${W}%`},children:T?c.jsx("div",{className:"flex items-center justify-center h-full",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-medical-blue"})}):c.jsx("div",{className:"max-w-4xl mx-auto",children:c.jsxs("div",{className:"glass rounded-xl p-12 leading-relaxed",children:[c.jsx("h2",{className:"text-3xl font-bold text-white mb-6",children:r.title}),c.jsx("div",{className:"prose prose-lg prose-invert",children:c.jsx("pre",{className:"whitespace-pre-wrap font-sans text-gray-200",children:_})})]})})}),c.jsx(o,{children:$&&c.jsxs(x.div,{initial:{width:0,opacity:0},animate:{width:400,opacity:1},exit:{width:0,opacity:0},className:"glass border-l border-white/10 flex flex-col",children:[c.jsx("div",{className:"p-4 border-b border-white/10",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(N,{className:"w-5 h-5 text-medical-purple"}),c.jsx("h3",{className:"text-lg font-semibold text-white",children:"AI Assistant"})]}),c.jsx("button",{onClick:()=>z(!1),className:"p-1 rounded hover:bg-white/10 transition-colors",children:c.jsx(h,{className:"w-5 h-5 text-gray-400"})})]})}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[R&&c.jsxs("div",{className:"mb-4 p-3 rounded-lg bg-medical-blue/10 border border-medical-blue/20",children:[c.jsx("p",{className:"text-xs text-medical-blue mb-1",children:"Selected Text:"}),c.jsx("p",{className:"text-sm text-gray-300",children:R})]}),Q&&c.jsx("div",{className:"mb-4 p-4 rounded-lg bg-white/5 border border-white/10",children:c.jsxs("div",{className:"flex items-start gap-2",children:[c.jsx(y,{className:"w-4 h-4 text-medical-purple mt-1"}),c.jsx("div",{className:"flex-1",children:c.jsx("p",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:Q})})]})})]}),c.jsx("div",{className:"p-4 border-t border-white/10",children:c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"text",value:G,onChange:e=>H(e.target.value),onKeyPress:e=>"Enter"===e.key&&X(),placeholder:"Ask about this content...",className:"flex-1 px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-gray-500 focus:outline-none focus:border-medical-purple"}),c.jsx(x.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:X,disabled:T||!G.trim(),className:"p-2 rounded-lg bg-medical-purple hover:bg-medical-purple/80 disabled:opacity-50",children:T?c.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"}):c.jsx(S,{className:"w-5 h-5 text-white"})})]})})]})})]})]})]})};export{A as default};
